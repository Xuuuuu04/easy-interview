# 修复计划更新“慢一拍”的问题

您观察得非常敏锐，这确实不是错觉。根据我的代码分析，目前 AI 在更新计划时，**只看到了你刚才说的话，而没有看到它自己即将做出的回应**。这导致它在判断当前话题是否结束时，缺少了最关键的上下文——即“面试官（AI）是否决定放过这个问题，还是决定追问”。

例如：
1. **你回答了问题**。
2. **后台评估程序**看到你的回答，觉得还行，准备打钩。
3. **前台 AI** 看到你的回答，觉得不够好，决定追问。
4. **冲突**：后台打钩了，但前台还在聊这个话题。或者反过来，后台还在等，前台已经换话题了。

这造成了计划更新与实际对话流的脱节（Lag）。

## 解决方案

我们需要在启动后台评估任务之前，**先将 AI 生成的最新回复（`reply_text`）加入到对话历史中**。这样，后台评估程序就能看到完整的对话闭环：

> 用户说 X -> AI 回复 Y

评估程序将基于这完整的交互来判断：既然 AI 已经回复了 Y（比如“好的，下一个问题...”），那么当前任务 X 显然已经结束了，可以放心地打钩。

## 执行步骤

1.  **修改 `app/api/routes/interview.py`**：
    *   在调用 `interview_service.evaluate_plan_async` 之前，先构建一个新的 `full_context_messages` 列表。
    *   将 AI 生成的 `reply_text` 作为一个 `assistant` 消息追加到这个列表中。
    *   将这个包含完整上下文的列表传递给评估函数。

2.  **验证**：
    *   确保修改后，后台评估程序能正确解析包含 AI 回复的上下文。
    *   这不会影响前端响应速度，因为评估依然是异步（后台）进行的。

这将彻底消除“慢一拍”的感觉，让计划更新与 AI 的实际话术完美同步。
